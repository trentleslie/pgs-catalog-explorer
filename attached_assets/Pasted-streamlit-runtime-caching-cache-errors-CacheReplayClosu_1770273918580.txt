streamlit.runtime.caching.cache_errors.CacheReplayClosureError: While running get_enriched_scores(), a streamlit element is called on some layout block created outside the function. This is incompatible with replaying the cached effect of that element, because the referenced block might not exist when the replay happens.

How to fix this:

Move the creation of $THING inside get_enriched_scores().
Move the call to the streamlit element outside of get_enriched_scores().
Remove the @st.cache_data decorator from get_enriched_scores().
Traceback:
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/exec_code.py", line 129, in exec_func_with_error_handling
    result = func()
             ^^^^^^
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/scriptrunner/script_runner.py", line 689, in code_to_exec
    exec(code, module.__dict__)  # noqa: S102
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/workspace/app.py", line 870, in <module>
    main()
File "/home/runner/workspace/app.py", line 111, in main
    scores_df, eval_summary_df = load_data_with_progress()
                                 ^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/workspace/app.py", line 98, in load_data_with_progress
    scores_df, eval_summary_df = get_enriched_scores()
                                 ^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/caching/cache_utils.py", line 281, in __call__
    return self._get_or_create_cached_value(args, kwargs, spinner_message)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/caching/cache_utils.py", line 306, in _get_or_create_cached_value
    return self._handle_cache_hit(cached_result)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/caching/cache_utils.py", line 332, in _handle_cache_hit
    replay_cached_messages(
File "/home/runner/workspace/.pythonlibs/lib/python3.11/site-packages/streamlit/runtime/caching/cached_message_replay.py", line 290, in replay_cached_messages
    raise CacheReplayClosureError(cache_type, cached_func) from ex